{% include 'head.html' %}

<body>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    {% include 'svgandheader.html' %}
    <form id="deleteEntityForm" method="POST">
        {% csrf_token %}
        <label for="delete_type">Delete Type:</label>
        <select name="delete_type" id="delete_type" class="form-select mb-3">
            <option value="species">Species</option>
            <option value="animal">Animal</option>
            <option value="venue">Venue</option>
        </select>
        
        
    <div id="speciesFields" style="display: none;">
        <div id="entityTable" class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>habitat</th>
                        <th>temperature</th>
                        <th>humidity</th>
                        <th>light_intensity</th>
                        <th>Operation</th>
                    </tr>
                </thead>
                <tbody id="entityList">                
    
    {% for entity in species_list %}
    <tr>
        <td>{{ entity.name }}</td>
        <td>{{ entity.habitat }}</td>
        <td>{{ entity.temperature }}</td>
        <td>{{ entity.humidity }}</td>
        <td>{{ entity.light_intensity }}</td>
        <td>
            <button onclick="editEntity('species', {{ entity.id }})" class="btn btn-sm btn-warning" data-toggle="tooltip" data-placement="top" title="Edit">Edit
                    <i class="fas fa-edit"></i>
            </button> 
        <button onclick="deleteEntity('species', {{ entity.id }})" class="btn btn-danger btn-sm">Delete</button></td>
    </tr>
    {% endfor %}
    </div>
                </tbody>
            </table>

        </div>
    </div>
    </form>

    <div id="animalFields" style="display: none;">
        <div id="entityTable" class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>age</th>
                        <th>diet</th>
                        <th>species</th>
                        <th>venue</th>
                        <th>Operation</th>
                    </tr>
                </thead>
                <tbody id="entityList">        
    {% for entity in animal_list %}
    <tr>
        <td>{{ entity.name }}</td>
        <td>{{ entity.age}}</td>
        <td>{{ entity.diet }}
            <button type="button" class="btn btn-sm btn-info" data-toggle="tooltip" data-placement="top" title="{{ entity.diet }}">
            <i class="fa fa-info-circle"></i>
            </button>
        </td>
        <td>{{ entity.species }}</td>
        <td>{{ entity.venue }}</td>
        
        <td>
            <button onclick="editEntity('animal', {{ entity.id }})" class="btn btn-sm btn-warning" data-toggle="tooltip" data-placement="top" title="Edit">Edit
                    <i class="fas fa-edit"></i>
            </button>        
            <button onclick="deleteEntity('animal', {{ entity.id }})" class="btn btn-danger btn-sm">Delete</button>
        </td>
    </tr>
    {% endfor %}
    </div>
                </tbody>
            </table>

        </div>
    </div>
    </form>

    <div id="venueFields" style="display: none;">
        <div id="entityTable" class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Operation</th>
                    </tr>
                </thead>
                <tbody id="entityList">    
    {% for entity in venue_list %}
    <tr>
        <td>{{ entity.name }}</td>
        <td>
            <button onclick="editEntity('venue', {{ entity.id }})" class="btn btn-sm btn-warning" data-toggle="tooltip" data-placement="top" title="Edit">Edit
                    <i class="fas fa-edit"></i>
            </button> 
        <button onclick="deleteEntity('venue', {{ entity.id }})" class="btn btn-danger btn-sm">Delete</button></td>
    </tr>
    {% endfor %}
    </div>
</tbody>
            </table>
        </div>
    </div>
    </form>

    <script>
        document.getElementById('delete_type').addEventListener('change', function() {
            var entityType = this.value;
            var speciesFields = document.getElementById('speciesFields');
            var animalFields = document.getElementById('animalFields');
            var venueFields = document.getElementById('venueFields');

            if (entityType === 'species') {
                speciesFields.style.display = 'block';
                animalFields.style.display = 'none';
                venueFields.style.display = 'none';
            } else if (entityType === 'animal') {
                speciesFields.style.display = 'none';
                animalFields.style.display = 'block';
                venueFields.style.display = 'none';
            } else if (entityType === 'venue') {
                speciesFields.style.display = 'none';
                animalFields.style.display = 'none';
                venueFields.style.display = 'block';
            }
        });

        function updateEntityList() {
            const entityType = document.getElementById('delete_type').value;
            fetch(`/get_entities/?entity_type=${entityType}`)
                .then(response => response.json())
                .then(data => {
                    const entityList = document.getElementById('entityList');
                    entityList.innerHTML = ''; // Clear previous list
                    data.forEach(entity => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${entity.name}</td>
                            <td><button onclick="deleteEntity('${entityType}', ${entity.id})" class="btn btn-danger btn-sm">Delete</button></td>
                        `;
                        entityList.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching entities:', error));
        }

        // Function to delete entity
        function deleteEntity(entityType, entityId) {
            fetch('/delete_entity/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: new URLSearchParams({
                    entity_type: entityType,
                    entity_id: entityId
                })
            })
            .then(response => {
                if (response.ok) {
                    updateEntityList(); // Refresh entity list after successful deletion
                } else {
                    console.error('Error deleting entity:', response.statusText);
                }
            })
            .catch(error => console.error('Error deleting entity:', error));
        }

        document.getElementById('delete_type').addEventListener('change', updateEntityList);
        updateEntityList(); // Initial update of entity list when page loads
    
        $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });

    </script>
    {% include 'footer.html' %}
</body>

    {% comment %} {% include 'svgandheader.html' %}

    <h2>Delete Entity</h2>
    
    <h3>Species</h3>
    <ul>
        {% for species in species_list %}
        <li>
            {{ species.name }} - <button onclick="deleteEntity('species', {{ species.id }})">Delete</button>
        </li>
        {% endfor %}
    </ul>

    <h3>Animal</h3>
    <ul>
        {% for animal in animal_list %}
        <li>
            {{ animal.name }} - <button onclick="deleteEntity('animal', {{ animal.id }})">Delete</button>
        </li>
        {% endfor %}
    </ul>

    <h3>Venue</h3>
    <ul>
        {% for venue in venue_list %}
        <li>
            {{ venue.name }} - <button onclick="deleteEntity('venue', {{ venue.id }})">Delete</button>
        </li>
        {% endfor %}
    </ul>

    <script>
        function deleteEntity(entityType, entityId) {
            fetch('/delete_entity/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: new URLSearchParams({
                    entity_type: entityType,
                    entity_id: entityId
                })
            })
            .then(response => {
                if (response.ok) {
                    window.location.reload(); // Refresh page after successful deletion
                } else {
                    console.error('Error deleting entity:', response.statusText);
                }
            })
            .catch(error => console.error('Error deleting entity:', error));
        }
    </script> {% endcomment %}
